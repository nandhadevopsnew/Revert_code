Frontend docker file:
-------------------
# Stage 1: Build the React app
FROM node:20 as build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# Stage 2: Serve the built app
FROM node:20
RUN npm install -g serve
WORKDIR /app
COPY --from=build /app/build ./build
EXPOSE 3000
CMD ["serve", "-s", "build", "-l", "3000"]


Backend docker file:
--------------------
FROM python:3.10-slim     #FROM python:3.11.9

WORKDIR /opt/Base_chat_platform

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        git \
        libgl1 \
        libglib2.0-0 && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

COPY requirements.txt .

RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["uvicorn", "local_api:app", "--host", "0.0.0.0", "--port", "8000"]



Docker compose.yml file:
------------------------
version: '3.8'

services:
  frontend:
    build:
      context: ./frontend
    container_name: react_frontend
    ports:
      - "3000:3000"
    restart: always
    networks:
      - graytitude_net

  backend:
    build:
      context: ./backend
    container_name: fastapi_backend
    ports:
      - "8000:8000"
    restart: always
    volumes:
      - ./backend/config.yaml:/app/config.yaml
    environment:
      - CONFIG_PATH=/app/config.yaml
    networks:
      - graytitude_net

  automation_backend:
    build:
      context: ./automation/backend
    container_name: automation_backend
    ports:
      - "8005:8005"
    restart: always
    working_dir: /app
    volumes:
      - ./automation/backend/config.yaml:/app/config.yaml
      - ./automation/backend/newFile_servicenow/config.yaml:/app/newFile_servicenow/config.yaml
      - ./automation/backend:/app
    environment:
      - CONFIG_PATH=/app/config.yaml
    networks:
      - graytitude_net

  nginx:
    image: nginx:latest
    container_name: convoautomation_nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/convoautomation.conf:/etc/nginx/conf.d/default.conf
      - ./certbot/www:/var/www/certbot
      - /etc/letsencrypt:/etc/letsencrypt
      - /var/log/nginx:/var/log/nginx
      # âœ… Add these volume mappings
      - ./html_paths:/html_paths
      - ./incident_summary/incident_summary.txt:/incident_summary.txt
      - ./table_variable:/table_variable
      - ./var/www/certbot:/var/www/certbot
      - ./certbot_www:/var/www/certbot
    depends_on:
      - frontend
      - backend
      - automation_backend
    restart: always
    networks:
      - graytitude_net

networks:
  graytitude_net:
    driver: bridge


Nginx configuration:
--------------------
# HTTP server (only for Certbot validation)
server {
    listen 80;
    server_name convoautomation.com www.convoautomation.com;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 301 https://$host$request_uri;
    }
}

# HTTPS server (production traffic)
server {
    listen 443 ssl;
    server_name convoautomation.com www.convoautomation.com;

    ssl_certificate /etc/letsencrypt/live/convoautomation.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/convoautomation.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    location / {
        proxy_pass http://frontend:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /chat/ {
        proxy_pass http://backend:8000/chat;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /chatws/ {
        proxy_pass http://backend:8000/chatws/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
    }

    location /upload_documents/ {
        proxy_pass http://backend:8000/upload_documents/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    client_max_body_size 100M;
    error_log /var/log/nginx/chat_error.log;
    access_log /var/log/nginx/chat_access.log;
}

backup nginx:
---------------
server {
    listen 80;
    server_name convoautomation.com www.convoautomation.com;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name convoautomation.com;

    ssl_certificate /etc/letsencrypt/live/convoautomation.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/convoautomation.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    location / {
        proxy_pass http://frontend:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /chat/ {
        proxy_pass http://backend:8000/chat;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
location /chatws {
        proxy_pass http://backend:8000/chatws;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
    }

    location /upload_documents {
        proxy_pass http://backend:8000/chatupload_documents;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    client_max_body_size 100M;
    error_log /var/log/nginx/chat_error.log;
    access_log /var/log/nginx/chat_access.log;
}


Current nginx;
--------------

server {
    listen 80;
    server_name convoautomation.com;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name convoautomation.com;

    ssl_certificate /etc/letsencrypt/live/convoautomation.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/convoautomation.com/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    location / {
        proxy_pass http://frontend:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /chat/ {
        proxy_pass http://backend:8000/chat;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /chatws {
        proxy_pass http://backend:8000/chatws;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
    }

    location /upload_documents {
        proxy_pass http://backend:8000/chatupload_documents;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /chatagent/ {
        proxy_pass http://automation_backend:8005/chatagent/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_read_timeout 3600;
        proxy_send_timeout 3600;
    }
    location /chatagentws/ {
        proxy_pass http://automation_backend:8005/chatagentws/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_read_timeout 3600;
        proxy_send_timeout 3600;
    }

    client_max_body_size 100M;
    error_log /var/log/nginx/chat_error.log;
    access_log /var/log/nginx/chat_access.log;
}



Amayaflow nginx:
----------------
server {
    server_name test.amayaflow.com;

    root /var/www/html/amayaflow/build;
    index index.html;

    # Main project
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Optional subfolder for test-ai
    location /test-ai/ {
        alias /var/www/html/amayaflow/test-ai/;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # SPA fallback
    error_page 404 /index.html;

    listen 443 ssl; # HTTPS
    ssl_certificate /etc/letsencrypt/live/test.amayaflow.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/test.amayaflow.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    access_log /var/log/nginx/test_amayaflow_access.log;
    error_log /var/log/nginx/test_amayaflow_error.log;
}

# Redirect HTTP to HTTPS
server {
    if ($host = test.amayaflow.com) {
        return 301 https://$host$request_uri;
    }

    listen 80;
    server_name test.amayaflow.com;
    return 404;
}